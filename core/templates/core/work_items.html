{% extends "core/base.html" %}
{% load static %}

{% block content %}

<h4 class="mb-3">
    üìã Kh·ªëi l∆∞·ª£ng c√¥ng vi·ªác ‚Äì {{ project.name }}
</h4>

<!-- ================= TH√îNG B√ÅO ================= -->
{% if messages %}
<div class="alert alert-info">
    <ul class="mb-0">
        {% for message in messages %}
            <li>{{ message }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<!-- ================= IMPORT EXCEL ================= -->
<div class="card mb-4">
    <div class="card-header bg-info text-white">
        üì• Import kh·ªëi l∆∞·ª£ng c√¥ng vi·ªác t·ª´ Excel
    </div>
    <div class="card-body">

        <p class="text-muted small mb-2">
            File Excel y√™u c·∫ßu c√°c c·ªôt:
            <strong>Ch·ªâ m·ª•c</strong>,
            <strong>T√™n c√¥ng vi·ªác</strong>,
            <strong>ƒê∆°n v·ªã</strong>,
            <strong>Kh·ªëi l∆∞·ª£ng</strong>
        </p>

        <form method="post"
              action="{% url 'import_work_items_excel' project.id %}"
              enctype="multipart/form-data">

            {% csrf_token %}

            <div class="row">
                <div class="col-md-6">
                    <input type="file"
                           name="excel_file"
                           class="form-control"
                           required>
                </div>
                <div class="col-md-3">
                    <button type="submit"
                            class="btn btn-primary btn-sm mt-1">
                        üì• Import Excel
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- ================= DANH S√ÅCH C√îNG VI·ªÜC ================= -->
<div class="card">
    <div class="card-header bg-secondary text-white">
        üìë Danh s√°ch c√¥ng vi·ªác
    </div>

    <div class="card-body p-0">
        <table class="table table-bordered table-sm mb-0">
            <thead class="table-light">
                <tr>
                    <th style="width: 110px;">Ch·ªâ m·ª•c</th>
                    <th>T√™n c√¥ng vi·ªác</th>
                    <th style="width: 120px;">ƒê∆°n v·ªã</th>
                    <th style="width: 150px;">Kh·ªëi l∆∞·ª£ng</th>
                </tr>
            </thead>
            <tbody>
                {% for item in work_items %}
                <tr>
                    <td>
                        <strong>{{ item.index_code }}</strong>
                    </td>

                    <!-- CLICK ‚Üí D·ª∞ TR√ô V·∫¨T T∆Ø -->
                    <td style="padding-left: {{ item.level|add:1 }}em;">
                        <a href="{% url 'work_item_materials' item.id %}"
                           class="text-decoration-none">
                            {% if item.children.exists %}
                                <strong>{{ item.name }}</strong>
                            {% else %}
                                {{ item.name }}
                            {% endif %}
                        </a>
                    </td>

                    <td>{{ item.unit }}</td>

                    <td class="text-end">
                        {% if item.quantity %}
                            {{ item.quantity }}
                        {% else %}
                            ‚Äî
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4"
                        class="text-center text-muted">
                        Ch∆∞a c√≥ kh·ªëi l∆∞·ª£ng c√¥ng vi·ªác n√†o
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- ================= QUAY L·∫†I DASHBOARD ================= -->
<a href="{% url 'project_dashboard' project.id %}"
   class="btn btn-secondary btn-sm mt-3">
    ‚Üê Quay l·∫°i dashboard d·ª± √°n
</a>

{% endblock %}
